# 异常处理
## 常见异常
### AttributeError异常


```python
class Animal(object):
    pass
```


```python
al=Animal()
```


```python
al.run()
```


    ---------------------------------------------------------------------------

    AttributeError                            Traceback (most recent call last)

    Input In [3], in <cell line: 1>()
    ----> 1 al.run()
    

    AttributeError: 'Animal' object has no attribute 'run'



```python
print(al.age)
```


    ---------------------------------------------------------------------------

    AttributeError                            Traceback (most recent call last)

    Input In [4], in <cell line: 1>()
    ----> 1 print(al.age)
    

    AttributeError: 'Animal' object has no attribute 'age'



```python
print(Animal.weight)
```


    ---------------------------------------------------------------------------

    AttributeError                            Traceback (most recent call last)

    Input In [5], in <cell line: 1>()
    ----> 1 print(Animal.weight)
    

    AttributeError: type object 'Animal' has no attribute 'weight'


### OSError异常


```python
f=open('abc.txt')
```


    ---------------------------------------------------------------------------

    FileNotFoundError                         Traceback (most recent call last)

    Input In [6], in <cell line: 1>()
    ----> 1 f=open('abc.txt')
    

    FileNotFoundError: [Errno 2] No such file or directory: 'abc.txt'


### IndexError异常


```python
code_list=[125,56,89,36]
code_list[4]
```


    ---------------------------------------------------------------------------

    IndexError                                Traceback (most recent call last)

    Input In [7], in <cell line: 2>()
          1 code_list=[125,56,89,36]
    ----> 2 code_list[4]
    

    IndexError: list index out of range


### KeyError异常
访问字典里不存在的键时引发


```python
dict1[104]
```


    ---------------------------------------------------------------------------

    NameError                                 Traceback (most recent call last)

    Input In [9], in <cell line: 1>()
    ----> 1 dict1[104]
    

    NameError: name 'dict1' is not defined


### NameError异常


```python
value1
```


    ---------------------------------------------------------------------------

    NameError                                 Traceback (most recent call last)

    Input In [10], in <cell line: 1>()
    ----> 1 value1
    

    NameError: name 'value1' is not defined



```python
a=value1
```


    ---------------------------------------------------------------------------

    NameError                                 Traceback (most recent call last)

    Input In [11], in <cell line: 1>()
    ----> 1 a=value1
    

    NameError: name 'value1' is not defined



```python
value1=10
```

### TypeError异常


```python
i='2'
```


```python
print(5/i)
```


    ---------------------------------------------------------------------------

    TypeError                                 Traceback (most recent call last)

    Input In [14], in <cell line: 1>()
    ----> 1 print(5/i)
    

    TypeError: unsupported operand type(s) for /: 'int' and 'str'


### ValueError异常


```python
i='QWE'
```


```python
print(5/int(i))
```


    ---------------------------------------------------------------------------

    ValueError                                Traceback (most recent call last)

    Input In [16], in <cell line: 1>()
    ----> 1 print(5/int(i))
    

    ValueError: invalid literal for int() with base 10: 'QWE'


## 捕获异常
### try-except语句


```python
import datetime as dt

def read_date(in_date):
    try:
        date=dt.datetime.strptime(in_date,'%Y-%m-%d')
        return date
    except ValueError:
        print('处理ValueError异常')


str_date='2018-8-18'
print('日期={0}'.format(read_date(str_date)))
```

    日期=2018-08-18 00:00:00
    


```python
def read_date(in_date):
    try:
        date=dt.datetime.strptime(in_date,'%Y-%m-%d')
        return date
    except ValueError as e:
        print('处理ValueError异常')
        print(e)
```


```python
str_date='201B-8-18'
print('日期={0}'.format(read_date(str_date)))
```

    处理ValueError异常
    time data '201B-8-18' does not match format '%Y-%m-%d'
    日期=None
    

### 多except代码块


```python
import datetime as dt


def read_date_from_file(filename):
    try:
        file=open(filename)
        in_date=file.read()
        in_date=in_date.strip()
        date=dt.datetime.strptime(in_date,'%Y-%m-%d')
        return date
    except ValueError as e:
        print('处理ValueError异常')
        print(e)
    except FileNotFoundError as e:
        print('处理FileNotFoundError异常')
        print(e)
        
date=read_date_from_file('read.txt')
print('日期={0}'.format(date))
```

    处理FileNotFoundError异常
    [Errno 2] No such file or directory: 'read.txt'
    日期=None
    


```python
import datetime as dt


def read_date_from_file(filename):
    try:
        file=open(filename)
        in_date=file.read()
        in_date=in_date.strip()
        date=dt.datetime.strptime(in_date,'%Y-%m-%d')
        return date
    except ValueError as e:
        print('处理ValueError异常')
        print(e)
    except FileNotFoundError as e:
        print('处理FileNotFoundError异常')
        print(e)
    except OSError as e:
        print('处理OSError异常')
        print(e)
        
date=read_date_from_file('read.txt')
print('日期={0}'.format(date))
```

    处理FileNotFoundError异常
    [Errno 2] No such file or directory: 'read.txt'
    日期=None
    

### try-except语句嵌套


```python
import datetime as dt

def read_date_from_file(filename):
    try:
        file=open(filename)
        try:
            in_date = file.read()
            in_date = in_date.strip()
            date = dt.datetime.strptime(in_date, '%Y-%m-%d')
            return date
        except ValueError as e:
            print('处理ValueError异常')
            print(e)
    except FileNotFoundError as e:
        print('处理FileNotFoundError异常')
        print(e)
    except OSError as e:
        print('处理OSError异常')
        print(e)
        
date=read_date_from_file('read.txt')
print('日期={0}'.format(date))
```

    处理FileNotFoundError异常
    [Errno 2] No such file or directory: 'read.txt'
    日期=None
    

### 多重异常捕获


```python
import datetime as dt
def read_date_from_file(filename):
    try:
        file=open(filename)
        in_date=file.read()
        in_date=in_date.strip()
        date=dt.datetime.strptime(in_date,'%Y-%m-%d')
        return date
    except (ValueError,OSError) as e:
        print('调用---')
        print(e)
        
date=read_date_from_file('read.txt')
print('日期={0}'.format(date))

```

    调用---
    [Errno 2] No such file or directory: 'read.txt'
    日期=None
    

## 异常堆栈跟踪


```python
import datetime as dt
import traceback as tb
def read_date_from_file(filename):
    try:
        file=open(filename)
        in_date=file.read()
        in_date=in_date.strip()
        date=dt.datetime.strptime(in_date,'%Y-%m-%d')
        return date
    except (ValueError,OSError) as e:
        print('调用---')
        print(e)
        tb.print_exc()
        
date=read_date_from_file('read.txt')
print('日期={0}'.format(date))
```

    调用---
    [Errno 2] No such file or directory: 'read.txt'
    日期=None
    

    Traceback (most recent call last):
      File "C:\Users\HP\AppData\Local\Temp\ipykernel_8772\538862610.py", line 5, in read_date_from_file
        file=open(filename)
    FileNotFoundError: [Errno 2] No such file or directory: 'read.txt'
    

## 释放资源
### finally代码块


```python
import datetime as dt
def read_date_from_file(filename):
    try:
        file=open(filename)
        in_date=file.read()
        in_date=in_date.strip()
        date=dt.datetime.strptime(in_date,'%Y-%m-%d')
        return date
    except ValueError as e:
        print('处理ValueError异常')
        print(e)
    except FileNotFoundError as e:
        print('处理FileNotFoundError异常')
        print(e)
    except OSError as e:
        print('处理OSError异常')
        print(e)
    finally:
        file.close()
        
date=read_date_from_file('read.txt')
print('日期={0}'.format(date))
```

    处理FileNotFoundError异常
    [Errno 2] No such file or directory: 'read.txt'
    


    ---------------------------------------------------------------------------

    UnboundLocalError                         Traceback (most recent call last)

    Input In [7], in <cell line: 21>()
         18     finally:
         19         file.close()
    ---> 21 date=read_date_from_file('read.txt')
         22 print('日期={0}'.format(date))
    

    Input In [7], in read_date_from_file(filename)
         17     print(e)
         18 finally:
    ---> 19     file.close()
    

    UnboundLocalError: local variable 'file' referenced before assignment


### else代码块


```python
import datetime as dt
import traceback as tb

def read_date_from_file(filename):
    try:
        file=open(filename)
    except OSError as e:
        print('打开文件失败')
    else:
        print('打开文件成功')
        try:
            in_date = file.read()
            in_date = in_date.strip()
            date = dt.datetime.strptime(in_date, '%Y-%m-%d')
            return date
        except ValueError as e:
            print('处理ValueError异常')
            print(e)
        except OSError as e:
            print('处理OSError异常')
            print(e)
        finally:
            file.close()
            
date=read_date_from_file('read.txt')
print('日期={0}'.format(date))
```

    打开文件失败
    日期=None
    

### with as 代码块自动资源管理


```python
import datetime as dt
def read_date_from_file(filename):
    try:
        with open(filename) as file:
            in_date=file.read()
        in_date=in_date.strip()
        date=dt.datetime.strptime(in_date,'%Y-%m-%d')
        return date
    except ValueError as e:
        print('处理ValueError异常')
        print(e)
    except OSError as e:
        print('处理OSError异常')
        print(e)
        
date=read_date_from_file('read.txt')
print('日期={0}'.format(date))
```

    处理OSError异常
    [Errno 2] No such file or directory: 'read.txt'
    日期=None
    

## 自定义异常类


```python
class MyException(Exception):
    def __init__(self,message):
        super().__init__(message)
```

## 显式抛出异常


```python
import datetime as dt
class MyException(Exception):
    def __init__(self,message):
        super().__init__(message)
        
def read_date_from_file(filename):
    try:
        file=open(filename)
        in_date=file.read()
        in_date=in_date.strip()
        date=dt.datetime.strptime(in_date,'%Y-%m-%d')
        return date
    except ValueError as e:
        raise MyException('不是有效日期')
    except FileNotFoundError as e:
        raise MyException('文件找不到')
    except OSError as e:
        raise MyException('文件无法打开或无法读取')

date=read_date_from_file('read.txt')
print('日期={0}'.format(date))
```


    ---------------------------------------------------------------------------

    FileNotFoundError                         Traceback (most recent call last)

    Input In [4], in read_date_from_file(filename)
          7 try:
    ----> 8     file=open(filename)
          9     in_date=file.read()
    

    FileNotFoundError: [Errno 2] No such file or directory: 'read.txt'

    
    During handling of the above exception, another exception occurred:
    

    MyException                               Traceback (most recent call last)

    Input In [4], in <cell line: 20>()
         17     except OSError as e:
         18         raise MyException('文件无法打开或无法读取')
    ---> 20 date=read_date_from_file('read.txt')
         21 print('日期={0}'.format(date))
    

    Input In [4], in read_date_from_file(filename)
         14     raise MyException('不是有效日期')
         15 except FileNotFoundError as e:
    ---> 16     raise MyException('文件找不到')
         17 except OSError as e:
         18     raise MyException('文件无法打开或无法读取')
    

    MyException: 文件找不到



```python

```
